---
import { getCollection } from "astro:content";

const posts = await getCollection("blog");

// Sort by newest first
const sorted = posts.sort(
  (a, b) => b.data.date.valueOf() - a.data.date.valueOf()
);

// Collect unique tags
const tags = Array.from(
  new Set(posts.flatMap((p) => p.data.tags ?? []))
).sort();
---

<div class="bg-white dark:bg-[var(--sl-color-bg)] py-12 sm:py-12">
  <div class="mx-auto max-w-7xl px-6 lg:px-8">
    <div class="mx-auto max-w-2xl lg:mx-0">
      <h1 class="text-4xl font-semibold tracking-tight text-pretty text-gray-900 dark:text-white sm:text-5xl">From the blog</h1>
      <p class="mt-2 text-lg/8 text-gray-600 dark:text-gray-400">Stay up to date with ComputeSDK's latest news and updates.</p>
    </div>
    <div class="mx-auto mt-10 pt-10 grid max-w-2xl grid-cols-1 gap-x-8 gap-y-16 border-t border-gray-200 lg:mx-0 lg:max-w-none lg:grid-cols-3">
      {sorted.map((post) => (
        <article class="flex mt-0 p-4 max-w-xl flex-col items-start justify-between border border-gray-200 rounded-lg hover:border-gray-700">
          <div class="flex items-center gap-x-4 text-xs">
            <time datetime={post.data.date.toISOString().split('T')[0]} class="text-gray-700">
              {post.data.date.toLocaleDateString('en-US', { 
                year: 'numeric', 
                month: 'short', 
                day: 'numeric' 
              })}
            </time>
            {post.data.tags && post.data.tags[0] && (
              <a href="#" class="relative z-10 rounded-full border border-gray-200 bg-gray-50 px-2 py-1 font-medium text-gray-600 hover:bg-gray-100 no-underline">
                {post.data.tags[0]}
              </a>
            )}
          </div>
          <div class="group relative grow">
            <h2 class="mt-3 text-lg/6 font-semibold text-gray-900 dark:text-white group-hover:text-gray-600 dark:group-hover:text-gray-400">
              <a href={`/blog/${post.slug}/`} class="no-underline">
                <span class="absolute inset-0"></span>
                {post.data.title}
              </a>
            </h2>
            {post.data.description && (
              <p class="mt-5 line-clamp-2 text-sm/6 text-gray-600 dark:text-gray-400">
                {post.data.description}
              </p>
            )}
          </div>
          <div class="relative mt-8 flex items-center gap-x-4 justify-self-end">
            <img src={post.data.image} alt="" class="size-10 rounded-full bg-gray-50" />
            <div class="text-sm/6 mt-0 items-center gap-y-2">
              <p class="font-semibold text-gray-900 dark:text-white">
                <a href="#" class="no-underline">
                  <span class="absolute inset-0"></span>
                  {post.data.author}
                </a>
              </p>
              <p class="text-gray-600 mt-0 dark:text-gray-400">{post.data.role}</p>
            </div>
          </div>
        </article>
      ))}
    </div>
  </div>
</div>
